<!DOCTYPE html>
<html lang="ko">

<head>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#317EFB">
  <link rel="icon" type="image/png" href="favicon.png?v=2">
  <link rel="icon" type="image/x-icon" href="favicon.ico?v=2">
  <link rel="apple-touch-icon" href="favicon.png?v=2">
  <link rel="shortcut icon" href="favicon.ico?v=2">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ğŸ„MemoooooğŸ„</title>
  <style>
    #loginView {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      height: 50px;
      background-color: #ccc;
      z-index: 999;
      position: relative;
    }

    /* ===============================
      Global Reset & iOS Fix
    ================================ */
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html {
      -webkit-text-size-adjust: 100%;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
      background: #f5f5f7;
      color: #111;
    }

    /* ( í¬ë¡¬, ì‚¬íŒŒë¦¬, ì˜¤í˜ë¼, ì—£ì§€ ) ë™ì‘ */
    .scroll::-webkit-scrollbar {
      display: none;
    }

    .scroll {
      -ms-overflow-style: none; /* ì¸í„°ë„· ìµìŠ¤í”Œë¡œëŸ¬ */
      scrollbar-width: none; /* íŒŒì´ì–´í­ìŠ¤ */
    }


    /* ìŠ¤í¬ë¡¤ë°” ìƒì„± */
    .scroll {
      width: 300px;
      height: 300px;
      overflow-y: scroll;
    }

    .scroll p {
      font-size: 2rem;
      padding: 0.6rem 1rem;
      background: #febf00;
    }

    /* ì…ë ¥ ì‹œ í™•ëŒ€ ë°©ì§€ (iOS í•µì‹¬) */
    input,
    textarea,
    [contenteditable] {
      font-size: 16px !important;
      touch-action: manipulation;
    }

    /* ===============================
      Navigation Bar
    ================================ */
    #navbar {
      position: sticky;
      top: 0;
      height: 56px;
      padding: 0 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;

      background: rgba(255, 255, 255, 0.75);
      backdrop-filter: blur(14px);
      border-bottom: 1px solid rgba(0, 0, 0, .06);
      z-index: 9999;
    }

    #navTitle {
      font-size: 17px;
      font-weight: 600;
      letter-spacing: -0.02em;
    }

    #installBtn {
      border: none;
      border-radius: 999px;
      padding: 6px 14px;
      font-size: 14px;
      background: #317efb;
      color: #fff;
    }

    /* ===============================
      Masonry Layout
    ================================ */
    #listView {
      padding: 20px;
      column-gap: 12px;
      column-count: 5;
    }

    @media (max-width: 1200px) {
      #listView {
        column-count: 4;
      }
    }

    @media (max-width: 900px) {
      #listView {
        column-count: 3;
      }
    }

    /* ëª¨ë°”ì¼: ë¬´ì¡°ê±´ 2ì—´ */
    @media (max-width: 600px) {
      #listView {
        column-count: 2;
        padding: 14px;
        column-gap: 10px;
      }
    }

    /* ===============================
      Memo Card (Apple Style)
    ================================ */
    .memo-card {
      background: rgba(255, 255, 255, 0.92);
      backdrop-filter: blur(12px);
      border-radius: 18px;
      padding: 14px 16px;
      margin-bottom: 14px;
      break-inside: avoid;
      cursor: pointer;

      box-shadow:
        0 1px 2px rgba(0, 0, 0, .04),
        0 8px 24px rgba(0, 0, 0, .06);

      transition:
        transform .25s cubic-bezier(.2, .8, .2, 1),
        box-shadow .25s cubic-bezier(.2, .8, .2, 1);
    }

    /* Hover (Desktop) */
    @media (hover: hover) {
      .memo-card:hover {
        transform: translateY(-4px) scale(1.01);
        box-shadow:
          0 6px 16px rgba(0, 0, 0, .08),
          0 20px 40px rgba(0, 0, 0, .12);
      }
    }

    /* Click / Tap í™•ëŒ€ íŠ¸ëœì§€ì…˜ */
    .memo-card:active {
      transform: scale(0.97);
    }

    /* ===============================
      Card Typography
    ================================ */
    .memo-subject {
      font-size: 16px;
      font-weight: 600;
      letter-spacing: -0.02em;
      color: #111;
      margin-bottom: 8px;
    }

    .memo-text {
      font-size: 14px;
      line-height: 1.55;
      color: #555;
      letter-spacing: -0.01em;

      display: -webkit-box;
      -webkit-line-clamp: 5;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    /* ===============================
      Floating Add Button
    ================================ */
    #addBtn {
      position: fixed;
      right: 22px;
      bottom: 22px;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      border: none;

      background: rgba(49, 126, 251, .9);
      color: #fff;
      font-size: 22px;

      box-shadow: 0 10px 24px rgba(49, 126, 251, .35);
      transition: transform .2s ease;
    }

    #addBtn:hover {
      transform: scale(1.08) rotate(45deg);
    }

    /* ===============================
      Editor View
    ================================ */
    #editorView {
      display: none;
      position: fixed;
      flex-direction: column;  /* ì œëª©/ë²„íŠ¼ + ë³¸ë¬¸ì„ ì„¸ë¡œ ë°°ì¹˜ */
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: min(720px, 92vw);
      min-height: 300px;
      max-height: 70vh;
      background: #ffffff;
      border-radius: 5px;
      padding: 5px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.18);
      z-index: 99999;
    }

    #editorSubject {
      width: 100%;
      font-size: 20px;
      font-weight: 600;
      border: none;
      outline: none;
      border-bottom: 1px solid #eaeaea;
      background-color: #ffffff;
      padding: 10px 6px;
      margin-bottom: 12px;
      flex-shrink: 0; /* ì œëª© ì˜ì—­ ê³ ì • */
    }

    #editorText {
      flex: 1; /* ë‚˜ë¨¸ì§€ ê³µê°„ ì±„ìš°ê¸° */
      width: 100%;
      min-height: 300px;
      max-height: 50vh;
      border: none;
      outline: none;
      font-size: 16px;
      line-height: 1.6;
      padding: 8px 6px;
      margin-bottom: 20px;

      overflow-y: auto; /* ì„¸ë¡œ ìŠ¤í¬ë¡¤ í™œì„±í™” */
    }

    #editorText img,
    .memo-text img {
      max-width: 100%;
      border-radius: 12px;
    }

    @media (max-width: 600px) {
      #editorView {
        top: 40%;
        width: 80vw;
        height: calc(60vh - 72px); /* ìƒë‹¨ navbar/í—¤ë” ì œì™¸ */
        max-height: 60vh;
        border-radius: 0;
        padding-bottom: calc(12px + env(safe-area-inset-bottom));
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      }

      #editorText{
        min-height: 300px;
        max-height: 40vh;
        font-size: 15px;
        line-height: 1.4;

        -webkit-overflow-scrolling: touch; /* iOS ìŠ¤ë¬´ìŠ¤ ìŠ¤í¬ë¡¤ */
      }
    }

    /* ===============================
      Buttons (iOS Style)
    ================================ */
    #editorButtons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      flex-shrink: 0; /* ë²„íŠ¼ ì˜ì—­ ê³ ì • */
    }
    
    .editor-btn,
    #deleteMemoBtn,
    #closeEditor {
      font-size: 14px;
      padding: 4px 8px;
      border-radius: 3px;
      border: 1px solid #ddd;
      background: #f8f8f8;
      cursor: pointer;
    }

    #deleteMemoBtn {
      z-index: 9999;
      align-self: flex-start;
      background: rgba(255, 59, 48, .12);
      border: none;
      font-size: 14px;
      color: #ff3b30;
      padding: 4px 8px;
      cursor: pointer;
    }

    #closeEditor {
      margin-left: auto;
      z-index: 9999;
      align-self: flex-end;
      background: none;
      border: none;
      color: #111;
    }

    /* ===============================
      Saving Overlay
    ================================ */
    #savingOverlay {
      display: none;
      position: fixed;
      width: 100%;
      bottom: 0;
      text-align: center;
      background: #00000010;
      backdrop-filter: blur(6px);

      z-index: 9999;
    }

    #donottouch {
      display: none;
      position: fixed;
      width: 100%;
      height: 100vh;
      left:0;
      top:0;
      background: #00000030;
      color: #00000000;
      z-index: 9999;
    }

    /* ===============================
      iOS Install Guide Overlay
    ================================ */
    #iosInstallGuide {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100000;

      background: rgba(0, 0, 0, 0.45);
      backdrop-filter: blur(10px);
    }

    #iosInstallGuide .ios-box {
      width: min(320px, 90%);
      background: rgba(255, 255, 255, 0.95);
      border-radius: 18px;
      padding: 20px 18px;
      text-align: center;

      box-shadow:
        0 10px 30px rgba(0, 0, 0, 0.25);

      animation: iosGuidePop .28s cubic-bezier(.2,.8,.2,1);
    }

    #iosInstallGuide strong {
      display: block;
      font-size: 16px;
      margin-bottom: 8px;
    }

    #iosInstallGuide p {
      font-size: 14px;
      line-height: 1.5;
      margin: 0 0 14px;
    }

    #iosInstallGuide button {
      border: none;
      border-radius: 10px;
      padding: 6px 14px;
      font-size: 14px;
      background: rgba(0, 0, 0, .08);
    }

    /* Pop Animation */
    @keyframes iosGuidePop {
      from {
        transform: scale(0.96);
        opacity: 0;
      }
      to {
        transform: scale(1);
        opacity: 1;
      }
    }


    /* ===============================
      Dark Mode (Auto)
    ================================ */
    @media (prefers-color-scheme: dark) {
      body {
        background: #0f0f10;
        color: #f5f5f7;
      }

      #navbar {
        background: rgba(28, 28, 30, .75);
        border-bottom: 1px solid rgba(255, 255, 255, .08);
      }

      .memo-card {
        background: rgba(28, 28, 30, .9);
        box-shadow:
          0 1px 2px rgba(0, 0, 0, .6),
          0 12px 28px rgba(0, 0, 0, .8);
      }

      .memo-subject {
        color: #f5f5f7;
      }

      .memo-text {
        color: #b0b0b5;
      }

      #editorView {
        background: #1c1c1e;
      }

      #editorSubject,
      #editorText {
        color: #f5f5f7;
        background-color: #1c1c1e;
        border-color: rgba(255, 255, 255, .1);
      }

      .editor-btn,
      #closeEditor {
        background: rgba(255, 255, 255, .08);
        color: #f5f5f7;
      }

      #deleteMemoBtn {
        background: rgba(255, 59, 48, .2);
        color: #ff453a;
      }

      #iosInstallGuide .ios-box {
        background: rgba(28, 28, 30, 0.95);
        color: #f5f5f7;
      }

      #iosInstallGuide button {
        background: rgba(255, 255, 255, .12);
        color: #f5f5f7;
      }
    }

    /* ===============================
      Navbar Scroll Enhancement
    ================================ */
    #navbar {
      transition:
        backdrop-filter .25s ease,
        background-color .25s ease,
        box-shadow .25s ease;
    }

    /* ìŠ¤í¬ë¡¤ ì‹œ */
    #navbar.scrolled {
      backdrop-filter: blur(22px);
      background: rgba(255, 255, 255, 0.85);
      box-shadow: 0 6px 20px rgba(0,0,0,.08);
    }

    /* ë‹¤í¬ëª¨ë“œ */
    @media (prefers-color-scheme: dark) {
      #navbar.scrolled {
        background: rgba(28, 28, 30, 0.88);
        box-shadow: 0 6px 24px rgba(0,0,0,.6);
      }
    }
  </style>
</head>

<body>
  <div id="navbar">
    <div id="navTitle">ğŸ„ Memooooooooooooooo</div>
    <button id="installBtn">ì„¤ì¹˜</button>
  </div>

  <!-- Login -->
  <div id="loginView">
    <div id="g_id_onload" data-client_id="765077747854-o62lf714ob2ncr2sq0l68ies31hp6p43.apps.googleusercontent.com"
      data-callback="handleLogin" data-auto_prompt="false">
    </div>
    <div class="g_id_signin"></div>
  </div>

  <!-- iOS Install Guide -->
  <div id="iosInstallGuide">
    <div class="ios-box">
      <strong>ğŸ“² í™ˆ í™”ë©´ì— ì¶”ê°€í•˜ê¸°</strong>
      <p>
        Safari í•˜ë‹¨ì˜ <b>ê³µìœ  ë²„íŠ¼</b> â†’<br>
        <b>â€œí™ˆ í™”ë©´ì— ì¶”ê°€â€</b>ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš” ğŸ„
      </p>
      <button id="closeIosGuide">ë‹«ê¸°</button>
    </div>
  </div>

  <div id="body-rapper">
    <!-- List -->
    <div id="listView"></div>

    <!-- Editor -->
    <div id="editorView">
      <input id="editorSubject" placeholder="ğŸ„ ì œëª© ğŸ„">

      <!-- ì´ë¯¸ì§€ ë²„íŠ¼ + ì‚­ì œ ë²„íŠ¼ -->
      <div id="editorButtons">
        <button class="editor-btn" id="uploadImageBtn" style="display:none;">ì´ë¯¸ì§€ ğŸ„</button>
        <button class="editor-btn" id="urlImageBtn" style="display:none;">URL ì´ë¯¸ì§€ ğŸ„</button>
      </div>

      <div id="editorText" contenteditable="true" placeholder="ğŸ„ ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì´ë¯¸ì§€ ê°€ëŠ¥) ğŸ„"></div>
      <input type="file" id="imageInput" style="display:none" accept="image/*">
      <div id="editorButtons">
        <button class="editor-btn" id="deleteMemoBtn">ë©”ëª¨ ì‚­ì œ</button>
        <p id="editorDateString" style="font-size: 14px; color:#00000070; height: 22px; margin-left: 5px;"></p>
        <button id="closeEditor">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

  <button id="addBtn">+</button>

  <!-- Saving -->
  <div id="donottouch"></div>
  <div id="savingOverlay">ğŸ„ Saving... </div>

  <script>
    /* =========================
      State
    ========================= */
    const state = {
      userId: null,
      memos: [],
      activeMemoIndex: null,
    };

    const navbar = document.getElementById("navbar");

    const sndMoo    = new Audio("mooooo.wav");
    sndMoo.preload  = "auto";
    
    let audioUnlocked = false;
    let autoSaveTimer = null;

    const listView      = document.getElementById("listView");
    const editorView    = document.getElementById("editorView");
    const editorSubject = document.getElementById("editorSubject");
    const editorText    = document.getElementById("editorText");
    const editorDate    = document.getElementById("editorDateString");
    const imageInput    = document.getElementById("imageInput");


  </script>

  <script>
    async function hashSHA256(message) {
      const encoder = new TextEncoder();
      const data    = encoder.encode(message);

      const hashBuffer  = await crypto.subtle.digest("SHA-256", data);
      const hashArray   = Array.from(new Uint8Array(hashBuffer));
      const hashHex     = hashArray
        .map(b => b.toString(16).padStart(2, "0"))
        .join("");

      return hashHex;
    }
  </script>
  <script>
    window.addEventListener("scroll", () => {
      if (window.scrollY > 8) {
        navbar.classList.add("scrolled");
      } else {
        navbar.classList.remove("scrolled");
      }
    });
  </script>
  <script>
    /* =========================
        ì‚¬ìš´ë“œ ì¬ìƒ
    ========================= */
    function playSound(audio) {
        if (!audioUnlocked) return;

        audio.pause();
        audio.currentTime = 0;
        audio.play().catch(() => {});
    }

    document.addEventListener("pointerdown", () => {
        if (audioUnlocked) return;

        audioUnlocked = true;

        const silent  = new Audio();
        silent.src    = "data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA=";
        silent.play().catch(() => {});
    }, { once: true });
  </script>
  <script>
    /* =========================
        Render Masonry
    ========================= */
    function renderList() {
      listView.innerHTML = "";
      state.memos.forEach((memo, i) => {
        const div     = document.createElement("div");
        div.className = "memo-card";
        div.innerHTML = `
          <div class="memo-subject">ğŸ„ ${memo.subject}</div>
          <div class="memo-text">${memo.text}</div>
        `;
        div.onclick = () => openEditor(i);
        listView.appendChild(div);
      });
    }

    /* =========================
        Editor ì—´ê¸°
    ========================= */
    function openEditor(index) {
      playSound(sndMoo);

      const dontouch          = document.getElementById("donottouch");
      dontouch.style.display  = "flex";

      state.activeMemoIndex   = index;

      const memo              = state.memos[index];

      editorSubject.value     = memo.subject;
      editorText.innerHTML    = memo.text;
      editorDate.textContent  = memo.date;

      editorView.style.display = "block";
    }

    /* =========================
        ìƒˆ ë©”ëª¨ ìƒì„±
    ========================= */
    document.getElementById("addBtn").onclick = async () => {
      //const m_date = new Date().toISOString();
      const m_date = new Date().toLocaleString('sv-SE', {
        timeZone: 'Asia/Seoul'
      });
      const m_hash = await hashSHA256(m_date);

      state.memos.unshift({
        subject: "",
        date: m_date,
        text: "",
        classification_code: m_hash,
        del: 0
      });
      openEditor(0);
    };

    /* =========================
        ì—ë””í„° ë‹«ê¸° & ì €ì¥
    ========================= */
    document.getElementById("closeEditor").onclick = () => {
      saveAndClose();
    };

    /* =========================
        ì´ë¯¸ì§€ ì—…ë¡œë“œ (Base64)
    ========================= */
    document.getElementById("uploadImageBtn").onclick = () => imageInput.click();
    imageInput.onchange = (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader  = new FileReader();
        reader.onload = function (evt) {
          const img = document.createElement("img");
          img.src   = evt.target.result; // Base64
          editorText.appendChild(img);
        };
        reader.readAsDataURL(file);
      }
    };

    /* =========================
        URLë¡œ ì´ë¯¸ì§€ ì¶”ê°€
    ========================= */
    document.getElementById("urlImageBtn").onclick = () => {
      const url = prompt("ğŸ„ ì´ë¯¸ì§€ URLì„ ì…ë ¥í•˜ì„¸ìš”:");
      if (url) {
        const img = document.createElement("img");
        img.src = url;
        editorText.appendChild(img);
      }
    };

    /* =========================
        ë©”ëª¨ ì‚­ì œ
    ========================= */
    document.getElementById("deleteMemoBtn").onclick = async () => {
      if (state.activeMemoIndex === null) return;

      if (!confirm("ğŸ„MeMoooooğŸ„oooooğŸ„ooooo?!!?!?!!")) return;

      const overlay   = document.getElementById("savingOverlay");
      const dontouch  = document.getElementById("donottouch");
      overlay.style.display   = "flex";
      dontouch.style.display  = "flex";

      const memo = state.memos[state.activeMemoIndex];

      // ì‚­ì œ í”Œë˜ê·¸
      memo.del = 1;

      try {
        await fetch(`${API_BASE}/save`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            userId: state.userId,
            Memooooo: [memo]   // ë©”ëª¨ 1ê±´ë§Œ ì „ì†¡
          })
        });

        // autoSave ì´ˆê¸°í™”
        if (autoSaveTimer) {
          clearTimeout(autoSaveTimer);
          autoSaveTimer = null;
        }
      } catch (err) {
        alert("ì‚­ì œ ì‹¤íŒ¨ ğŸ„\n" + err.message);
        return;
      }

      // ë¡œì»¬ ìƒíƒœ ì •ë¦¬
      state.memos.splice(state.activeMemoIndex, 1);
      state.activeMemoIndex     = null;
      editorView.style.display  = "none";
      renderList();

      overlay.style.display     = "none";
      dontouch.style.display    = "none";
    };

    /* ì´ˆê¸° ë Œë”ë§ */
    renderList();
  </script>

<script>
    const API_BASE = "https://memooooo-sheet-api.vercel.app/api";

    /* =========================
      Login
    ========================= */
    function handleLogin(res) {
      const payload = JSON.parse(atob(res.credential.split(".")[1]));
      state.userId  = payload.email;

      document.getElementById("loginView").style.display = "none";
      listView.style.display = "block";

      loadMemos();
    }

    /* =========================
      Load
    ========================= */
    async function loadMemos() {
      const dontouch          = document.getElementById("donottouch");
      dontouch.style.display  = "flex";

      try {
        const res = await fetch(`${API_BASE}/load?userId=${encodeURIComponent(state.userId)}`,
          {
            method: "GET",
            mode: "cors",
            credentials: "omit"
          }
        );
        const data  = await res.json();
        state.memos = data.Memooooo || [];
        renderList();
      } catch (err) {
        console.error("ë¡œë“œ ì‹¤íŒ¨:", err);
        alert("ë©”ëª¨ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
      } finally{
        dontouch.style.display  = "none";
      }
    }

    /* =========================
      Save
    ========================= */
    async function saveAndClose() {
      if (state.activeMemoIndex === null) return;

      const m_date = new Date().toLocaleString('sv-SE', {
        timeZone: 'Asia/Seoul'
      });

      const memo = state.memos[state.activeMemoIndex];

      // í˜„ì¬ ì—ë””í„° ë‚´ìš© ë°˜ì˜
      memo.subject  = editorSubject.value;
      memo.text     = editorText.innerHTML;
      memo.date     = m_date;
      memo.del      = 0;

      editorView.style.display = "none";
      renderList();

      const overlay   = document.getElementById("savingOverlay");
      const dontouch  = document.getElementById("donottouch");
      overlay.style.display   = "flex";
      dontouch.style.display  = "flex";

      try {
        const res = await fetch(`${API_BASE}/save`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            userId: state.userId,
            Memooooo: [memo]
          })
        });

        if (!res.ok) {
          throw new Error(await res.text());
        }
      } catch (err) {
        alert("ì €ì¥ ì‹¤íŒ¨\n" + err.message);
        return;
      } finally {
        playSound(sndMoo);
        console.log(memo);
        overlay.style.display   = "none";
        dontouch.style.display  = "none";
      }
    }

    /* =========================
      Auto Save
    ========================= */
    async function autoSaveSilently() {
      if (state.activeMemoIndex === null) return;
      if (editorView.style.display !== "block") return;

      const memo = state.memos[state.activeMemoIndex];

      memo.subject  = editorSubject.value;
      memo.text     = editorText.innerHTML;
      memo.del      = 0;

      try {
        const res = await fetch(`${API_BASE}/save`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            userId: state.userId,
            Memooooo: [memo]
          })
        });

        if (!res.ok) {
          throw new Error(await res.text());
        }
        console.log("ğŸ„ auto-saved");
      } catch (err) {
        console.error("ìë™ ì €ì¥ ì‹¤íŒ¨:", err);
      }
    }


    // ì…ë ¥ ê°ì§€
    function scheduleAutoSave() {
      if (autoSaveTimer) clearTimeout(autoSaveTimer);

      autoSaveTimer = setTimeout(() => {
        autoSaveSilently();
      }, 10000); // 10ì´ˆê°„ ì…ë ¥ ì—†ìœ¼ë©´
    }

    // ì œëª© ì…ë ¥
    editorSubject.addEventListener("input", scheduleAutoSave);

    // ë³¸ë¬¸ ì…ë ¥ (contenteditable)
    editorText.addEventListener("input", scheduleAutoSave);



    /* Ctrl / Cmd + S ì €ì¥ */
    window.addEventListener("keydown", e => {
      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "s") {
        e.preventDefault();
        saveAndClose();
      }
    });
  </script>

  <script>
    let deferredPrompt = null;

    function isStandalone(){
        return window.matchMedia("(display-mode: standalone)").matches || window.navigator.standalone === true;
    }

    /* =========================
      PWA Install Detect
    ========================= */
    window.addEventListener("beforeinstallprompt", e => {
      e.preventDefault();
      deferredPrompt = e;
      document.getElementById("installBtn").style.display = "block";
    });

    if (isStandalone()) {
      document.getElementById("installBtn").style.display = "none";
    } else {
      document.getElementById("installBtn").style.display = "block";
    }

    /* =========================
      Install Button Click
    ========================= */
    document.getElementById("installBtn").onclick = async () => {
      // ì„¤ì¹˜ ê°€ëŠ¥í•œ ë¸Œë¼ìš°ì €
      if (deferredPrompt) {
        deferredPrompt.prompt();
        await deferredPrompt.userChoice;
        deferredPrompt = null;
        return;
      }

      // iOS Safari
      if (isIOS()) {
        document.getElementById("iosInstallGuide").style.display = "flex";
        return;
      }

      alert("ì´ í™˜ê²½ì—ì„œëŠ” ì„¤ì¹˜ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ ğŸ„");
    };

    /* =========================
      iOS Detect
    ========================= */
    function isIOS() {
      return /iphone|ipad|ipod/i.test(navigator.userAgent);
    }

    document.getElementById("closeIosGuide").onclick = () => {
      document.getElementById("iosInstallGuide").style.display = "none";
    };

  </script>
</body>

</html>
